# 实验设备纳管

## 设备API抽象

``` mermaid
flowchart TB
    A[任务管理器] --> B[流程编排引擎]
    B --> C[设备适配器层]
    A --> D[状态管理器]
    D --> E[数据存储层]
    B --> F[通知服务]
    G[人工确认接口] --> A
    H[外部请求接口] --> A
    C --> I[配料设备API]
    C --> J[熔封设备API]
    C --> K[机械臂/高温炉/离心机API]
    C --> L[XRD衍射仪API]
```


┌─────────────────────────────────────────────────────────┐
│                    HTTP服务层                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ 任务提交API  │  │ 状态查询API  │  │ 人工确认API  │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                  任务编排引擎                            │
│  ┌──────────────────────────────────────────────────┐  │
│  │          状态机 (Workflow State Machine)          │  │
│  │  配料准备 → 配料 → 熔封准备 → 熔封 → 送样准备 →  │  │
│  │  送样 → 取样 → 切割准备 → XRD测量 → 完成        │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │              任务队列 (Task Queue)                │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                  设备适配层                              │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌──────┐ │
│  │配料设备│ │熔封设备│ │机械臂  │ │高温炉  │ │ XRD  │ │
│  └────────┘ └────────┘ └────────┘ └────────┘ └──────┘ │
└─────────────────────────────────────────────────────────┘


PENDING          → 任务已创建,等待执行
WAITING_MATERIAL → 等待人工装料确认
BATCHING         → 配料中
WAITING_SEAL     → 等待人工放入熔封设备
SEALING          → 熔封中
WAITING_RACK     → 等待人工放入货架
SAMPLING_IN      → 机械臂送样中
HEATING          → 高温炉加热中
SAMPLING_OUT     → 机械臂取样中
CENTRIFUGING     → 离心机处理中
WAITING_FIX      → 等待人工修整样品
XRD_MEASURING    → XRD测量中
COMPLETED        → 任务完成
FAILED           → 任务失败