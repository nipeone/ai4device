# 环境变量配置说明

## 1. 安装依赖

首先安装 `python-dotenv` 库：

```bash
pip install python-dotenv
```

或者使用 requirements.txt：

```bash
pip install -r requirements.txt
```

## 2. 创建 .env 文件

在项目根目录下创建 `.env` 文件，复制以下内容并根据实际情况修改：

```env
# ===================== 应用配置 =====================
APP_HOST=0.0.0.0
APP_PORT=8113
APP_DEBUG=False
ENVIRONMENT=development

# ===================== PLC 配置 =====================
PLC_IP=192.168.0.205
PLC_PORT=102

# ===================== 离心机配置 =====================
CENTRIFUGE_HOST=192.168.0.140
CENTRIFUGE_PORT=8000
CENTRIFUGE_TIMEOUT=5

# ===================== 防护门配置 =====================
DOOR_TARGET_ADDRESS=tcp://127.0.0.1:49202

# ===================== 高温炉配置 =====================
FURNACE_REQ_ADDR=tcp://127.0.0.1:49206
FURNACE_SUB_ADDR=tcp://127.0.0.1:49200
FURNACE_CTRL_ADDR=tcp://127.0.0.1:49201

# ===================== 配料设备配置 =====================
MIXER_API_BASE_URL=http://127.0.0.1:4669
MIXER_USERNAME=admin
MIXER_PASSWORD=admin
MIXER_TIMEOUT=30

# ===================== 日志配置 =====================
LOG_LEVEL=INFO
LOG_FILE=logs/app.log
```

## 3. 使用方法

### 3.1 在代码中使用环境变量

环境变量已经通过 `config.py` 模块加载，可以直接导入使用：

```python
import config

# 使用配置
plc_ip = config.PLC_IP
plc_port = config.PLC_PORT
```

### 3.2 设备初始化时自动使用环境变量

所有设备类已经更新，会自动从环境变量读取配置：

```python
from devices.plc_manager import plc_mgr
from devices.centrifuge_core import cent_sender
from devices.door_core import door_ctrl
from devices.furnace_core import oven_driver
from devices.mixer_core import mixer_controller

# 这些实例会自动使用 .env 文件中的配置
# 如果需要覆盖，可以在初始化时传入参数
custom_plc = PLCManager(ip="192.168.1.100", port=102)
```

### 3.3 在应用启动时加载

`app.py` 和 `main.py` 已经自动导入 `config` 模块，会在启动时加载 `.env` 文件。

## 4. 配置项说明

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `APP_HOST` | 应用监听地址 | `0.0.0.0` |
| `APP_PORT` | 应用监听端口 | `8113` |
| `APP_DEBUG` | 调试模式 | `False` |
| `PLC_IP` | PLC设备IP地址 | `192.168.0.205` |
| `PLC_PORT` | PLC设备端口 | `102` |
| `CENTRIFUGE_HOST` | 离心机IP地址 | `192.168.0.140` |
| `CENTRIFUGE_PORT` | 离心机端口 | `8000` |
| `DOOR_TARGET_ADDRESS` | 防护门ZMQ地址 | `tcp://127.0.0.1:49202` |
| `FURNACE_REQ_ADDR` | 高温炉请求地址 | `tcp://127.0.0.1:49206` |
| `FURNACE_SUB_ADDR` | 高温炉订阅地址 | `tcp://127.0.0.1:49200` |
| `FURNACE_CTRL_ADDR` | 高温炉控制地址 | `tcp://127.0.0.1:49201` |
| `MIXER_API_BASE_URL` | 配料设备API地址 | `http://127.0.0.1:4669` |
| `MIXER_USERNAME` | 配料设备用户名 | `admin` |
| `MIXER_PASSWORD` | 配料设备密码 | `admin` |

## 5. 注意事项

1. **`.env` 文件已添加到 `.gitignore`**，不会被提交到版本控制系统
2. 建议创建 `.env.example` 文件作为模板（不包含敏感信息）
3. 如果 `.env` 文件不存在，系统会使用代码中的默认值
4. 环境变量的优先级：命令行参数 > `.env` 文件 > 代码默认值

## 6. 示例

### 示例1：修改PLC IP地址

在 `.env` 文件中：

```env
PLC_IP=192.168.1.100
```

### 示例2：修改应用端口

在 `.env` 文件中：

```env
APP_PORT=9000
```

### 示例3：修改配料设备配置

在 `.env` 文件中：

```env
MIXER_API_BASE_URL=http://192.168.1.200:4669
MIXER_USERNAME=myuser
MIXER_PASSWORD=mypassword
```
